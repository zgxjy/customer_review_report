# 简易电商点评分析工具链 测试使用流程

本说明文档介绍如何通过命令行调用和测试以下三个核心脚本：

- `1-first_label.py`：自动化评论初步标注
- `2-second_data_correction.py`：数据矫正与标准化
- `3-process_single_part_report_data.py`：单项目报告数据处理与汇总

---

## 1. 环境准备

请确保已安装如下依赖（以 pip 为例）：

```bash
pip install pandas pymongo tqdm openai sentence-transformers matplotlib
```

并配置好 MongoDB 服务与 OpenAI API Key（环境变量 `OPEN_AI_KEY`）。

---

## 2. 各脚本命令行用法

### 1. 1-first_label.py 电商点评AI自动化标注

**功能简介**：  
- 对电商评论数据进行自动化话题、情感、用户画像等初步标注  
- 支持批量并行处理，结果写入MongoDB  
- 统计Token用量并生成报告

**常用命令行参数**（具体以脚本内 argparse 配置为准）：

```bash
python 1-first_label.py \
  --mongo_url mongodb://localhost:27017/ \
  --db_name kinyo_db \
  --reviews_collection kinyo_new_reviews \
  --llm_results_collection kinyo_llm_results \
  --model gpt-4o-mini \
  --max_workers 4 \
  --project-code kinyo-data-10 \
  --solution "AI自打标：不限定"
```

**测试建议**：
- 检查 `logs/1_first_label.log` 日志输出
- 检查 `logs/1_first_label_token_usage_report.json` Token统计报告
- MongoDB中 `kinyo_llm_results` 集合应有新标注结果

---

### 2. 2-second_data_correction.py 数据矫正与标准化

**功能简介**：  
- 对用户画像和商品话题分类进行标准化  
- 支持自动归一化、分类映射与批量处理  
- 统计Token用量并生成报告

**常用命令行参数**（具体以脚本内 argparse 配置为准）：

```bash
python 2-second_data_correction.py \
  --db_host localhost \
  --db_port 27017 \
  --db_name kinyo_db \
  --reviews_collection kinyo_new_reviews \
  --llm_results_collection kinyo_llm_results \
  --data_result_collection kinyo_data_result \
  --product_type 扩音器 \
  --project-code kinyo-data-10 \
  --solution "AI自打标：不限定"
```

**测试建议**：
- 检查 `logs/2_second_data_correction.log` 日志输出
- 检查 `logs/2_second_data_correction_token_usage.json` Token统计报告
- MongoDB中 `kinyo_data_result` 集合应有归一化后的数据

---

### 3. 3-process_single_part_report_data.py 单项目报告数据处理与汇总

**功能简介**：  
- 汇总用户画像、话题极性等分析结果  
- 生成可视化/统计报告  
- 支持Token用量统计

**常用命令行参数**（具体以脚本内 argparse 配置为准）：

```bash
python 3-process_single_part_report_data.py \
  --project-code kinyo-data-10 \
  --model gpt-4o-mini \
  --solution "AI自打标：不限定"
```

**测试建议**：
- 检查 `logs/3_single_part_data_processor.log` 日志输出
- 检查 `logs/3_single_part_token_usage_report.json` Token统计报告
- MongoDB中 `kinyo_data_result` 集合应有最终报告数据
- 输出目录 `outputs/` 下会生成分析报告JSON文件

---

## 3. 常见问题与排查

- 如遇到 OpenAI API 连接问题，请检查代理与 API Key 配置
- 日志与Token统计文件可帮助定位处理流程中的问题
- MongoDB连接异常请检查数据库服务状态和连接参数

---

## 4. 参考

- 各脚本均支持 `-h` 或 `--help` 查看详细命令行参数说明
- 推荐每次处理前备份数据库数据，便于回滚

---

如需进一步定制脚本参数或处理流程，请参考各脚本源码中的 `main()` 函数与 argparse 配置部分。

如有其他需求，欢迎随时补充！


本说明文档介绍如何通过命令行调用和测试以下三个核心脚本：

- `1-first_label.py`：自动化评论初步标注
- `2-second_data_correction.py`：数据矫正与标准化
- `3-process_report_data.py`：处理与汇总分析报告

---

## 1. 环境准备

请确保已安装如下依赖（以 pip 为例）：

```bash
pip install pandas pymongo tqdm openai sentence-transformers
```

并配置好 MongoDB 服务与 OpenAI API Key（环境变量 `OPEN_AI_KEY`）。

---

## 2. 各脚本命令行用法

### 1. 1-first_label.py 电商点评AI自动化标注

**功能简介**：  
- 对电商评论数据进行自动化话题、情感、用户画像等初步标注  
- 支持批量并行处理，结果写入MongoDB  
- 统计Token用量并生成报告

**常用命令行参数**（具体以脚本内 argparse 配置为准）：

```bash
python 1-first_label.py \
  --mongo_url mongodb://localhost:27017/ \
  --db_name kinyo_db \
  --reviews_collection kinyo_new_reviews \
  --llm_results_collection kinyo_llm_results \
  --model gpt-4o-mini \
  --max_workers 4 \
  --test_version kinyo-data-10 \
  --solution "AI自打标：不限定"
```

**测试建议**：
- 检查 `logs/1_first_label.log` 日志输出
- 检查 `logs/1_first_label_token_usage_report.json` Token统计报告
- MongoDB中 `kinyo_llm_results` 集合应有新标注结果

---

### 2. 2-second_data_correction.py 数据矫正与标准化

**功能简介**：  
- 对用户画像和商品话题分类进行标准化  
- 支持自动归一化、分类映射与批量处理  
- 统计Token用量并生成报告

**常用命令行参数**（支持的参数详见脚本 main 函数）：

```bash
python 2-second_data_correction.py \
  --db_host localhost \
  --db_port 27017 \
  --db_name kinyo_db \
  --reviews_collection kinyo_new_reviews \
  --llm_results_collection kinyo_llm_results \
  --data_result_collection kinyo_data_result \
  --product_type 扩音器 \
  --test_version kinyo-data-10 \
  --solution "AI自打标：不限定"
```

**测试建议**：
- 检查 `logs/2_second_data_correction.log` 日志输出
- 检查 `logs/2_second_data_correction_token_usage.json` Token统计报告
- MongoDB中 `kinyo_data_result` 集合应有归一化后的数据

---

### 3. 3-process_report_data.py 报告数据处理与汇总

**功能简介**：  
- 汇总用户画像、话题极性等分析结果  
- 生成可视化/统计报告  
- 支持Token用量统计

**常用命令行参数**（具体参数以 main 函数为准）：

```bash
python 3-process_report_data.py \
  --db_host localhost \
  --db_port 27017 \
  --db_name kinyo_db \
  --reviews_collection kinyo_new_reviews \
  --llm_results_collection kinyo_llm_results \
  --data_result_collection kinyo_data_result \
  --test_version kinyo-data-10 \
  --solution "AI自打标：不限定"
```

**测试建议**：
- 检查 `logs/3_data_processor.log` 日志输出
- 检查 `logs/3_token_usage_report.json` Token统计报告
- MongoDB中 `kinyo_data_result` 集合应有最终报告数据

---

## 3. 常见问题与排查

- 如遇到 OpenAI API 连接问题，请检查代理与 API Key 配置
- 日志与Token统计文件可帮助定位处理流程中的问题
- MongoDB连接异常请检查数据库服务状态和连接参数

---

## 4. 参考

- 各脚本均支持 `-h` 或 `--help` 查看详细命令行参数说明
- 推荐每次处理前备份数据库数据，便于回滚

---

如需进一步定制脚本参数或处理流程，请参考各脚本源码中的 `main()` 函数与 argparse 配置部分。

如有其他需求，欢迎随时补充！
